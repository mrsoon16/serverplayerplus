
<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Soon Craft – نسخه فوری</title>
<style>
    body{margin:0;background:#111;overflow:hidden;touch-action:none;font-family:sans-serif}
    canvas{display:block}
    #ui{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:10px}
    .btn{width:60px;height:60px;border-radius:12px;background:#444;color:#fff;font-size:18px;display:flex;align-items:center;justify-content:center;user-select:none}
    #score{position:fixed;top:10px;left:10px;color:#fff;font-size:20px}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="score">❤ 3</div>
<div id="ui">
  <div class="btn" id="left">←</div>
  <div class="btn" id="right">→</div>
  <div class="btn" id="jump">↥</div>
  <div class="btn" id="build">+ بلوک</div>
  <div class="btn" id="destroy">- بلوک</div>
</div>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
resize();window.addEventListener("resize",resize);

// Data
let player = {x:100,y:100,w:32,h:32,dx:0,dy:0,onGround:false,health:3};
const gravity = 0.5;
const blocks = [];
const enemies = [];

function addEnemy(){
  enemies.push({x:Math.random()*canvas.width,y:0,w:32,h:32,dx:(Math.random()<0.5?-1:1)*1,dy:0});
}
for(let i=0;i<5;i++)addEnemy();

// Controls
const keys={left:false,right:false,jump:false,build:false,destroy:false};
document.getElementById("left").ontouchstart=()=>keys.left=true;
document.getElementById("left").ontouchend=()=>keys.left=false;
document.getElementById("right").ontouchstart=()=>keys.right=true;
document.getElementById("right").ontouchend=()=>keys.right=false;
document.getElementById("jump").ontouchstart=()=>{if(player.onGround)player.dy=-10};
document.getElementById("build").ontouchstart=()=>{blocks.push({x:player.x,y:player.y+player.h,w:32,h:32});};
document.getElementById("destroy").ontouchstart=()=>{for(let i=0;i<blocks.length;i++){let b=blocks[i];if(Math.abs(b.x-player.x)<32&&Math.abs(b.y-player.y)<32){blocks.splice(i,1);break;}}};

// Physics helpers
function rectsCollide(a,b){return a.x<a.w+b.x&&a.x+a.w>b.x&&a.y<a.h+b.y&&a.y+a.h>b.y;}

function update(){
  // Player movement
  player.dx=0;
  if(keys.left)player.dx=-3;
  if(keys.right)player.dx=3;
  player.dy+=gravity;
  player.x+=player.dx;
  player.y+=player.dy;

  player.onGround=false;
  for(const b of blocks){
    if(rectsCollide({...player},b)){
      if(player.dy>0){player.y=b.y-player.h;player.dy=0;player.onGround=true;}
    }
  }

  // Boundaries
  if(player.y>canvas.height){player.y=0;player.health--;document.getElementById("score").innerText="❤ "+player.health;if(player.health<=0)alert("شکست خوردی!");}

  // Enemies
  enemies.forEach(e=>{
    e.dy+=gravity;
    e.x+=e.dx;
    e.y+=e.dy;
    if(e.x<0||e.x+e.w>canvas.width)e.dx*=-1;
    for(const b of blocks){
      if(rectsCollide(e,b)&&e.dy>0){e.y=b.y-e.h;e.dy=0;}
    }
    // Collision with player
    if(rectsCollide(e,player)){player.health--;document.getElementById("score").innerText="❤ "+player.health;if(player.health<=0)alert("شکست خوردی!");}
  });
}

function draw(){
  ctx.fillStyle="#111";ctx.fillRect(0,0,canvas.width,canvas.height);
  // Draw blocks
  ctx.fillStyle="#654321";
  blocks.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
  // Draw enemies
  ctx.fillStyle="#ff0033";
  enemies.forEach(e=>ctx.fillRect(e.x,e.y,e.w,e.h));
  // Draw player
  ctx.fillStyle="#00ff00";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
